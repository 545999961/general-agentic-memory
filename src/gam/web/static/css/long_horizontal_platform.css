:root {
    --bg-primary: #f5f7fa;
    --bg-secondary: #ffffff;
    --bg-tertiary: #f0f2f5;
    --bg-card: #ffffff;
    --bg-hover: #e8eaef;
    --border-color: #e0e3e8;
    --border-accent: #d0d4da;
    --text-primary: #1a1a2e;
    --text-secondary: #5a5a7a;
    --text-muted: #9a9ab0;
    --accent-primary: #6366f1;
    --accent-secondary: #8b5cf6;
    --accent-success: #16a34a;
    --accent-warning: #d97706;
    --accent-danger: #dc2626;
    --accent-info: #0891b2;
    --gradient-primary: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
    --gradient-success: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
    --gradient-chat: linear-gradient(135deg, #06b6d4 0%, #8b5cf6 100%);
    --gradient-memorize: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%);
    --shadow-lg: 0 20px 40px rgba(0,0,0,0.08);
    --font-mono: 'JetBrains Mono', monospace;
}

* { margin:0; padding:0; box-sizing:border-box; }
html, body { height:100%; overflow:hidden; }
body {
    font-family: 'Space Grotesk', -apple-system, BlinkMacSystemFont, sans-serif;
    background: var(--bg-primary);
    color: var(--text-primary);
    display: flex;
    flex-direction: column;
}

.bg-pattern {
    position: fixed; top:0; left:0; right:0; bottom:0;
    background:
        radial-gradient(circle at 20% 80%, rgba(99,102,241,0.05) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(139,92,246,0.05) 0%, transparent 50%),
        radial-gradient(circle at 40% 40%, rgba(6,182,212,0.04) 0%, transparent 40%);
    pointer-events: none; z-index:0;
}

/* Header */
.header {
    position: relative; z-index:10;
    display: flex; align-items: center; justify-content: space-between;
    padding: 8px 24px;
    background: rgba(255,255,255,0.95);
    backdrop-filter: blur(20px);
    border-bottom: 1px solid var(--border-color);
    flex-shrink: 0;
}
.logo { display:flex; align-items:center; gap:10px; font-size:18px; font-weight:700; }
.logo-icon { font-size:22px; }
.logo-text {
    background: var(--gradient-primary);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
}

/* Layout */
.app-container {
    position: relative; z-index:1;
    display: grid;
    grid-template-columns: 300px 1fr 380px;
    gap:0; flex:1; min-height:0; overflow:hidden;
}

/* Panels */
.panel { display:flex; flex-direction:column; min-height:0; overflow:hidden; border-right:1px solid var(--border-color); }
.panel:last-child { border-right:none; }
.panel-header {
    display:flex; align-items:center; justify-content:space-between;
    padding:12px 16px; border-bottom:1px solid var(--border-color);
    background:var(--bg-secondary); flex-shrink:0;
}
.panel-title { display:flex; align-items:center; gap:8px; font-size:13px; font-weight:600; }
.panel-title .icon { font-size:16px; }
.panel-body { flex:1; overflow-y:auto; min-height:0; }

/* Left Panel */
.left-panel { background:var(--bg-secondary); }
.left-panel .panel-body { display:flex; flex-direction:column; }

.section { border-bottom:1px solid var(--border-color); }
.section:last-child { border-bottom:none; }

#section-upload { flex:0 0 auto; }
#section-queries { flex:1 1 0; min-height:100px; display:flex; flex-direction:column; overflow:hidden; }
#section-gam { flex:1 1 0; min-height:100px; display:flex; flex-direction:column; overflow:hidden; }

.section-header {
    display:flex; align-items:center; justify-content:space-between;
    padding:10px 16px; background:var(--bg-tertiary);
}
.section-title {
    display:flex; align-items:center; gap:8px;
    font-size:12px; font-weight:600; color:var(--text-secondary);
    text-transform:uppercase; letter-spacing:0.5px;
}
.section-content { padding:12px 16px; }
.section-content.scrollable { flex:1; overflow-y:auto; min-height:0; padding:8px 12px; }

/* Buttons */
.btn {
    display:inline-flex; align-items:center; justify-content:center; gap:6px;
    padding:8px 14px; font-size:12px; font-weight:500; font-family:inherit;
    border:none; border-radius:8px; cursor:pointer; transition:all 0.2s;
}
.btn-primary { background:var(--gradient-primary); color:white; box-shadow:0 2px 8px rgba(99,102,241,0.2); }
.btn-primary:hover:not(:disabled) { transform:translateY(-1px); box-shadow:0 4px 12px rgba(99,102,241,0.3); }
.btn-secondary { background:var(--bg-tertiary); color:var(--text-primary); border:1px solid var(--border-color); }
.btn-secondary:hover { background:var(--bg-hover); }
.btn-sm { padding:5px 10px; font-size:11px; }
.btn-block { width:100%; }
.btn:disabled { opacity:0.5; cursor:not-allowed; transform:none !important; }

/* Badge */
.badge {
    display:inline-flex; align-items:center; padding:3px 8px;
    font-size:10px; font-weight:600; border-radius:12px;
    text-transform:uppercase; letter-spacing:0.5px;
}
.badge-success { background:rgba(34,197,94,0.15); color:var(--accent-success); }
.badge-warning { background:rgba(245,158,11,0.15); color:var(--accent-warning); }
.badge-info { background:rgba(6,182,212,0.15); color:var(--accent-info); }

/* Upload Zone */
.upload-zone {
    display:flex; flex-direction:column; align-items:center; justify-content:center;
    gap:6px; padding:14px 12px;
    background:var(--bg-primary); border:2px dashed var(--border-color);
    border-radius:8px; cursor:pointer; transition:all 0.2s;
}
.upload-zone:hover { border-color:var(--accent-primary); background:rgba(99,102,241,0.04); }
.upload-zone.dragover { border-color:var(--accent-primary); background:rgba(99,102,241,0.08); }
.upload-zone .icon { font-size:24px; opacity:0.6; }
.upload-zone .text { text-align:center; }
.upload-zone .text p { color:var(--text-secondary); font-size:12px; }
.upload-zone .text span { color:var(--accent-primary); font-weight:500; }
.upload-zone input { display:none; }

/* Doc list */
.doc-list { margin-top:8px; display:flex; flex-direction:column; gap:4px; }
.doc-item {
    display:flex; align-items:center; justify-content:space-between;
    padding:6px 8px; border-radius:6px;
    background:var(--bg-primary); border:1px solid var(--border-color);
    font-size:11px;
}
.doc-item .name { color:var(--text-secondary); flex:1; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
.doc-item .size { color:var(--text-muted); font-family:var(--font-mono); font-size:10px; margin-left:8px; }
.doc-item .remove-btn {
    background:none; border:none; cursor:pointer; color:var(--text-muted);
    font-size:12px; padding:2px 4px; margin-left:4px;
}
.doc-item .remove-btn:hover { color:var(--accent-danger); }

/* Text Input */
.text-input {
    width:100%; padding:8px 10px; font-family:inherit; font-size:12px; line-height:1.5;
    background:var(--bg-primary); border:1px solid var(--border-color); border-radius:8px;
    color:var(--text-primary); resize:vertical; transition:border-color 0.2s;
}
.text-input:focus { outline:none; border-color:var(--accent-primary); box-shadow:0 0 0 2px rgba(99,102,241,0.1); }
.text-input::placeholder { color:var(--text-muted); }

.form-group { margin-bottom:8px; }
.form-label { display:block; margin-bottom:4px; font-size:12px; font-weight:500; color:var(--text-secondary); }

/* Query Evolution */
.query-item {
    display:flex; align-items:flex-start; gap:8px;
    padding:8px 10px; margin-bottom:6px;
    border-radius:8px; background:var(--bg-primary);
    border-left:3px solid var(--accent-info);
    animation: fadeSlideIn 0.3s ease;
}
.query-item.memorized { border-left-color:var(--accent-warning); background:rgba(245,158,11,0.06); }
.query-item .query-index {
    flex-shrink:0; width:22px; height:22px;
    display:flex; align-items:center; justify-content:center;
    border-radius:50%; background:var(--accent-info); color:white;
    font-size:10px; font-weight:600;
}
.query-item.memorized .query-index { background:var(--accent-warning); }
.query-item .query-text { font-size:12px; color:var(--text-secondary); line-height:1.4; flex:1; }
.query-item .query-badge {
    font-size:9px; padding:2px 6px; border-radius:4px;
    background:rgba(245,158,11,0.15); color:var(--accent-warning);
    font-weight:600; flex-shrink:0;
}

/* GAM Tree */
.tree-node { user-select:none; }
.tree-item {
    display:flex; align-items:center; padding:5px 8px;
    border-radius:6px; cursor:pointer; transition:background 0.15s;
}
.tree-item:hover { background:var(--bg-hover); }
.tree-item .toggle { width:14px; text-align:center; color:var(--text-muted); font-size:9px; }
.tree-item .icon { margin-right:5px; font-size:13px; }
.tree-item .name { font-size:11px; color:var(--text-secondary); }
.tree-children { padding-left:14px; }
.tree-children.collapsed { display:none; }

/* ═══ Middle Panel: Conversation ═══ */
.middle-panel { background:var(--bg-primary); }
.middle-panel .panel-header {
    background:linear-gradient(135deg, rgba(99,102,241,0.06) 0%, rgba(139,92,246,0.06) 100%);
}
.conv-status { display:flex; align-items:center; gap:6px; font-size:11px; color:var(--text-muted); }
.conv-status .dot { width:8px; height:8px; border-radius:50%; background:var(--accent-success); }
.conv-status .dot.running { background:var(--accent-warning); animation:pulse 1s infinite; }

/* System Prompt Banner */
.system-prompt-banner {
    margin:16px 20px 0; padding:12px 16px;
    background:var(--bg-card); border:1px solid var(--border-color);
    border-radius:10px; position:relative;
}
.system-prompt-label {
    font-size:11px; font-weight:600; color:var(--accent-primary);
    text-transform:uppercase; letter-spacing:0.5px; margin-bottom:6px;
}
.system-prompt-content {
    font-family:var(--font-mono); font-size:11px; line-height:1.6;
    color:var(--text-muted); max-height:40px; overflow:hidden;
    transition:max-height 0.3s ease;
}
.system-prompt-content.expanded { max-height:600px; }
.system-prompt-toggle {
    display:block; margin-top:4px; background:none; border:none;
    color:var(--accent-primary); font-size:10px; cursor:pointer;
    font-family:inherit;
}

/* Conversation Timeline */
.conversation-timeline { padding:16px 20px; display:flex; flex-direction:column; gap:12px; }

.conv-row {
    display:flex; gap:12px; align-items:flex-start;
    animation: fadeSlideIn 0.4s ease;
}
.conv-row.request { flex-direction:row; }
.conv-row.response { flex-direction:row-reverse; }

.conv-bubble {
    max-width:75%; padding:10px 14px;
    border-radius:12px; font-size:12px; line-height:1.6;
    word-wrap:break-word; overflow-wrap:break-word; position:relative;
}

/* Request (left) */
.conv-row.request .conv-bubble {
    background:var(--bg-card); border:1px solid var(--border-color);
    border-bottom-left-radius:4px;
}

/* Response (right) */
.conv-row.response .conv-bubble {
    background:var(--bg-tertiary); border:1px solid var(--border-color);
    border-bottom-right-radius:4px;
}

.conv-bubble-label {
    font-size:10px; font-weight:600; color:var(--text-muted);
    text-transform:uppercase; letter-spacing:0.3px; margin-bottom:4px;
    display:flex; align-items:center; gap:4px;
}
.conv-bubble-label .label-icon { font-size:12px; }

.conv-bubble-body {
    font-family:var(--font-mono); font-size:11px; line-height:1.6;
    color:var(--text-secondary); white-space:pre-wrap;
    max-height:200px; overflow-y:auto;
}
.conv-bubble-body.expanded { max-height:none; }

.conv-bubble-toggle {
    display:inline-block; margin-top:4px; background:none; border:none;
    color:var(--accent-primary); font-size:10px; cursor:pointer;
    font-family:inherit;
}

/* Tool call specific */
.conv-bubble.tool-call {
    border-left:3px solid var(--accent-info);
}
.conv-bubble.tool-call.search-call { border-left-color:var(--accent-info); }
.conv-bubble.tool-call.memorize-call { border-left-color:var(--accent-warning); }
.conv-bubble.tool-call.recall-call { border-left-color:var(--accent-secondary); }

.conv-bubble.tool-result { border-right:3px solid var(--accent-info); }
.conv-bubble.tool-result.search-result { border-right-color:var(--accent-info); }
.conv-bubble.tool-result.memorize-result { border-right-color:var(--accent-warning); }
.conv-bubble.tool-result.recall-result { border-right-color:var(--accent-secondary); }

/* Memorize update highlight */
.conv-bubble.memorized-update {
    border-right-color:var(--accent-warning);
    background:rgba(245,158,11,0.06);
    animation:memorizeFlash 1s ease;
}
.conv-bubble.memorized-update .conv-bubble-body { font-weight:700; color:var(--text-primary); }
.conv-bubble.memorized-update .memorize-badge {
    display:inline-block; padding:2px 6px; border-radius:4px;
    background:var(--gradient-memorize); color:white;
    font-size:9px; font-weight:600; margin-left:6px;
}

@keyframes memorizeFlash {
    0% { box-shadow:0 0 0 0 rgba(245,158,11,0.4); }
    50% { box-shadow:0 0 12px 4px rgba(245,158,11,0.2); }
    100% { box-shadow:0 0 0 0 rgba(245,158,11,0); }
}

/* User query bubble */
.conv-bubble.user-query {
    background:var(--accent-primary); color:black;
    border-bottom-left-radius:4px;
}
.conv-bubble.user-query .conv-bubble-label { color:black }
.conv-bubble.user-query .conv-bubble-body { color:black; }

/* Assistant thinking */
.conv-bubble.assistant-msg {
    background:linear-gradient(135deg, rgba(99,102,241,0.06) 0%, rgba(139,92,246,0.06) 100%);
    border:1px solid rgba(99,102,241,0.15);
}

/* Round marker */
.conv-round-marker {
    display:flex; align-items:center; gap:10px;
    padding:4px 0; color:var(--text-muted); font-size:10px;
    animation: fadeSlideIn 0.3s ease;
}
.conv-round-marker .line { flex:1; height:1px; background:var(--border-color); }
.conv-round-marker .label {
    padding:2px 10px; border-radius:10px;
    background:var(--bg-tertiary); border:1px solid var(--border-color);
    font-weight:500; white-space:nowrap;
}

/* Final answer */
.conv-final-answer {
    margin:8px 0; padding:16px 20px;
    background:var(--bg-card); border:2px solid var(--accent-success);
    border-radius:12px; animation:fadeSlideIn 0.5s ease;
}
.conv-final-answer .label {
    font-size:11px; font-weight:600; color:var(--accent-success);
    text-transform:uppercase; margin-bottom:8px;
    display:flex; align-items:center; gap:6px;
}
.conv-final-answer .body { font-size:13px; line-height:1.7; color:var(--text-primary); }
.conv-final-answer .body p { margin:0 0 8px; }

/* Nudge */
.conv-nudge {
    margin:4px 0; padding:8px 14px;
    background:rgba(245,158,11,0.08); border:1px dashed var(--accent-warning);
    border-radius:8px; font-size:11px; color:var(--accent-warning);
    animation:fadeSlideIn 0.3s ease;
}

/* Empty state */
.conv-empty-state {
    display:flex; flex-direction:column; align-items:center; justify-content:center;
    height:100%; text-align:center; padding:40px; color:var(--text-muted);
}
.conv-empty-state .icon { font-size:56px; margin-bottom:16px; opacity:0.4; }
.conv-empty-state h3 { font-size:16px; margin-bottom:8px; color:var(--text-secondary); }
.conv-empty-state p { max-width:400px; line-height:1.6; font-size:13px; }

.empty-state {
    display:flex; flex-direction:column; align-items:center;
    padding:16px; text-align:center;
}
.empty-state .icon { font-size:28px; margin-bottom:6px; opacity:0.5; }
.empty-state p { color:var(--text-muted); font-size:11px; line-height:1.5; }

/* ═══ Right Panel: Chat ═══ */
.right-panel { background:var(--bg-secondary); }
.right-panel .panel-header {
    background:linear-gradient(135deg, rgba(6,182,212,0.06) 0%, rgba(139,92,246,0.06) 100%);
}
.chat-status { display:flex; align-items:center; gap:6px; font-size:11px; color:var(--text-muted); }
.chat-status .dot { width:8px; height:8px; border-radius:50%; background:var(--accent-success); }
.chat-status .dot.thinking { background:var(--accent-warning); animation:pulse 1s infinite; }

.chat-messages {
    flex:1; overflow-y:auto; padding:16px;
    display:flex; flex-direction:column; gap:16px; min-height:0;
}
.chat-message { display:flex; gap:10px; max-width:95%; }
.chat-message.user { align-self:flex-end; flex-direction:row-reverse; }
.chat-message.assistant { align-self:flex-start; }

.message-avatar {
    width:30px; height:30px; border-radius:8px;
    display:flex; align-items:center; justify-content:center;
    font-size:14px; flex-shrink:0;
}
.chat-message.user .message-avatar { background:var(--gradient-primary); }
.chat-message.assistant .message-avatar { background:var(--bg-tertiary); border:1px solid var(--border-color); }

.message-content {
    padding:10px 14px; border-radius:12px;
    font-size:13px; line-height:1.6;
    word-wrap:break-word; overflow-wrap:break-word;
    max-width:100%; overflow-x:hidden;
}
.chat-message.user .message-content {
    background:var(--accent-primary); color:white;
    border-bottom-right-radius:4px;
}
.chat-message.assistant .message-content {
    background:var(--bg-tertiary); color:var(--text-primary);
    border-bottom-left-radius:4px;
}
.message-content p { margin:0 0 8px; }
.message-content p:last-child { margin-bottom:0; }
.message-content code {
    font-family:var(--font-mono); font-size:11px;
    background:rgba(0,0,0,0.06); padding:2px 5px; border-radius:4px;
}
.message-content pre {
    background:var(--bg-primary); padding:10px; border-radius:6px;
    margin:8px 0; overflow-x:auto;
}
.message-content pre code { background:transparent; padding:0; }

.message-sources { margin-top:10px; padding-top:10px; border-top:1px solid var(--border-color); font-size:11px; }
.message-sources-title { font-weight:600; margin-bottom:4px; color:var(--text-secondary); }
.message-source-item {
    display:inline-block; background:var(--bg-primary);
    padding:2px 8px; border-radius:4px; margin:2px 4px 2px 0;
    font-family:var(--font-mono); font-size:10px;
    cursor:pointer; transition:all 0.2s; border:1px solid transparent;
}
.message-source-item:hover { background:var(--accent-primary); color:white; }

.chat-empty-state {
    display:flex; flex-direction:column; align-items:center; justify-content:center;
    height:100%; text-align:center; padding:24px;
}
.chat-empty-state .icon { font-size:40px; margin-bottom:12px; opacity:0.5; }
.chat-empty-state h3 { font-size:14px; margin-bottom:6px; color:var(--text-secondary); }
.chat-empty-state p { color:var(--text-muted); font-size:12px; max-width:240px; line-height:1.6; margin-bottom:12px; }

.chat-suggestions { display:flex; flex-direction:column; gap:6px; width:100%; }
.chat-suggestion {
    padding:8px 12px; font-size:11px; font-family:inherit;
    background:var(--bg-tertiary); border:1px solid var(--border-color);
    border-radius:8px; color:var(--text-secondary); cursor:pointer;
    transition:all 0.2s; text-align:left;
}
.chat-suggestion:hover { background:var(--bg-hover); border-color:var(--accent-info); color:var(--accent-info); }

.chat-input-container {
    padding:12px 16px; border-top:1px solid var(--border-color);
    background:var(--bg-tertiary); flex-shrink:0;
}
.chat-input-wrapper { display:flex; gap:10px; align-items:flex-end; }
.chat-input {
    flex:1; min-height:38px; max-height:100px;
    padding:9px 12px; font-family:inherit; font-size:13px;
    background:var(--bg-primary); border:1px solid var(--border-color);
    border-radius:10px; color:var(--text-primary); resize:none;
    transition:border-color 0.2s;
}
.chat-input:focus { outline:none; border-color:var(--accent-primary); box-shadow:0 0 0 2px rgba(99,102,241,0.1); }
.chat-input::placeholder { color:var(--text-muted); }
.chat-send-btn {
    width:38px; height:38px; border:none; border-radius:10px;
    background:var(--gradient-chat); color:white; font-size:15px;
    cursor:pointer; display:flex; align-items:center; justify-content:center;
    transition:transform 0.2s; flex-shrink:0;
}
.chat-send-btn:hover:not(:disabled) { transform:scale(1.05); }
.chat-send-btn:disabled { opacity:0.5; cursor:not-allowed; }

/* Typing indicator */
.typing-indicator { display:flex; gap:4px; padding:8px 12px; }
.typing-indicator span {
    width:7px; height:7px; background:var(--text-muted);
    border-radius:50%; animation:typing 1.4s infinite;
}
.typing-indicator span:nth-child(2) { animation-delay:0.2s; }
.typing-indicator span:nth-child(3) { animation-delay:0.4s; }
@keyframes typing {
    0%,60%,100% { transform:translateY(0); opacity:0.5; }
    30% { transform:translateY(-4px); opacity:1; }
}

.agent-actions { margin-top:6px; display:flex; flex-direction:column; gap:3px; max-height:140px; overflow-y:auto; }
.agent-action-item {
    display:flex; align-items:center; gap:6px;
    font-size:11px; font-family:var(--font-mono);
    color:var(--text-muted); padding:3px 8px;
    background:rgba(6,182,212,0.05); border-radius:6px;
    border-left:2px solid var(--accent-info);
    animation:fadeSlideIn 0.3s ease;
}

/* Animations */
@keyframes fadeSlideIn {
    from { opacity:0; transform:translateY(8px); }
    to { opacity:1; transform:translateY(0); }
}
@keyframes pulse {
    0%,100% { opacity:1; }
    50% { opacity:0.5; }
}

/* Scrollbar */
::-webkit-scrollbar { width:6px; height:6px; }
::-webkit-scrollbar-track { background:transparent; }
::-webkit-scrollbar-thumb { background:#ccc; border-radius:3px; }
::-webkit-scrollbar-thumb:hover { background:#aaa; }

/* Responsive */
@media (max-width:1400px) { .app-container { grid-template-columns:280px 1fr 340px; } }
@media (max-width:1200px) { .app-container { grid-template-columns:260px 1fr 300px; } }
